webpackJsonp([11],{"10VM":function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=t("//Fk"),i=t.n(o),l=t("c2Ch"),a=t("0zi8"),s=t("Joay"),r={name:"updatebook",data:function(){return{bookForm:{code:"",userId:"",iSBN:"",bookName:"",author:"",imgurl:"",publisher:"",publishTime:"",price:"",discount:"",upDate:"",storage:"",tips:"",imgList:[]},dialogImageUrl:"",dialogVisible:!1,disabled:!1,hideUploadAdd:!1,filelist:[],limitCount:4,postion:"left"}},components:{pageheader:a.a,pagefooter:s.a},computed:{newprice:function(){var e=this.bookForm.price*this.bookForm.discount*.01,n=Number(e).toFixed(3),t=n.substring(0,n.length-1);return Number(t)}},mounted:function(){var e=this,n=this.$route.params.bookId;Object(l.h)(n).then(function(n){if(null!=n.data){console.log(n.data),e.bookForm=n.data,console.log(n.data.imgurl);var t=n.data.imgurl.split(",");e.bookForm.imgurl=t,e.bookForm.publishTime=new Date(e.bookForm.publishTime)}})},methods:{formatDiscount:function(e){/^\+?[1-9][0-9]*$/.test(e)||this.$message({type:"warning",message:"折扣输入格式有误",showClose:!0})},newTransformBase64:function(e,n,t){var o=this,l=[];e.forEach(function(e,n){var t=new i.a(function(n,t){var o=new FileReader,i=void 0;e.raw&&(o.readAsDataURL(e.raw),o.onload=function(e){i=o.result,n(i)})});l.push(t)}),i.a.all(l).then(function(e){n(e)}).catch(function(e){t&&t(),o.$message.error("错误")})},handleAddChange:function(e){e.size/1024/1024<20?this.filelist.push(e):(this.$message.error("上传图片大小不能超过 20MB!"),this.filelist.splice(-1,1)),this.hideUploadAdd=this.filelist.length>=this.limitCount},handleExceed:function(e){this.hideUploadAdd=!0,this.$message({message:"上传文件超出限制个数！",type:"warning"})},handleRemove:function(e){var n=this;this.filelist.forEach(function(t,o){t.uid==e.uid&&(console.log("uid配对"),n.filelist.splice(o,1))}),this.hideUploadAdd=this.filelist.length>=this.limitCount},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},submitForm:function(e){var n=this;console.log(this.filelist),this.newTransformBase64(this.filelist,function(e){n.bookForm.imgList=e;var t=n.bookForm;n.bookForm.imgurl=null,n.bookForm.publishTime=new Date(n.bookForm.publishTime),n.bookForm.userId=n.$store.state.user.userId,console.log(n.$store.state.user.userId),n.bookForm.code="10001";t=n.bookForm;Object(l.r)(t).then(function(e){0!=e.data&&(console.log(e.data),n.$message({showClose:!0,message:"修改成功",type:"success"}),n.$router.push({name:"bookdetail",params:{bookId:e.data}}))})})},resetForm:function(e){this.$refs[e].resetFields()}}},m=function(){var e=this,n=e.$createElement,o=e._self._c||n;return o("div",[o("el-container",{attrs:{direction:"vertical"}},[o("el-main",[o("pageheader")],1),e._v(" "),o("div",{staticClass:"banner"},[o("el-container",{staticClass:"search",attrs:{direction:"horizontal"}},[o("el-main",[o("el-image",{staticStyle:{width:"230px",height:"88px"},attrs:{src:t("dLd/")}})],1),e._v(" "),o("el-container",{attrs:{direction:"vertical"}},[o("el-main",{staticClass:"search-input"},[o("el-input",{staticStyle:{width:"320px"},attrs:{placeholder:"请输入内容"}}),e._v(" "),o("el-button",[o("span",[e._v("搜索")])])],1),e._v(" "),o("el-main",{staticClass:"history"},[o("ul",{staticClass:"history"},[o("li",{staticClass:"his-li"},[e._v("莫言")]),e._v(" "),o("li",{staticClass:"his-li"},[e._v("余光中")]),e._v(" "),o("li",{staticClass:"his-li"},[e._v("毛姆")]),e._v(" "),o("li",{staticClass:"his-li"},[e._v("追风筝的人")]),e._v(" "),o("li",{staticClass:"his-li"},[e._v("莫言")]),e._v(" "),o("li",{staticClass:"his-li"},[e._v("余光中")])])])],1)],1)],1),e._v(" "),o("div",[o("el-form",{ref:"bookForm",staticClass:"book-form",attrs:{inline:!0,"label-position":e.postion,model:e.bookForm,"status-icon":"","label-width":"100px"}},[o("el-form-item",{attrs:{label:"ISBN"}},[o("el-input",{model:{value:e.bookForm.iSBN,callback:function(n){e.$set(e.bookForm,"iSBN",n)},expression:"bookForm.iSBN"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"书名"}},[o("el-input",{model:{value:e.bookForm.bookName,callback:function(n){e.$set(e.bookForm,"bookName",n)},expression:"bookForm.bookName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"作者"}},[o("el-input",{model:{value:e.bookForm.author,callback:function(n){e.$set(e.bookForm,"author",n)},expression:"bookForm.author"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"出版社"}},[o("el-input",{model:{value:e.bookForm.publisher,callback:function(n){e.$set(e.bookForm,"publisher",n)},expression:"bookForm.publisher"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"出版日期"}},[o("el-date-picker",{attrs:{type:"month",format:"yyyy-MM","value-format":"yyyy-MM-dd",placeholder:"选择年月"},model:{value:e.bookForm.publishTime,callback:function(n){e.$set(e.bookForm,"publishTime",n)},expression:"bookForm.publishTime"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"数量"}},[o("el-input-number",{staticStyle:{width:"auto"},attrs:{size:"large","controls-position":"right",min:1,max:999},model:{value:e.bookForm.storage,callback:function(n){e.$set(e.bookForm,"storage",n)},expression:"bookForm.storage"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"单价"}},[o("el-input",{model:{value:e.bookForm.price,callback:function(n){e.$set(e.bookForm,"price",n)},expression:"bookForm.price"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"折扣"}},[o("el-input",{attrs:{placeholder:"请输入百分比折扣"},on:{change:e.formatDiscount},model:{value:e.bookForm.discount,callback:function(n){e.$set(e.bookForm,"discount",n)},expression:"bookForm.discount"}},[o("template",{slot:"append"},[e._v("%")])],2)],1),e._v(" "),o("el-form-item",{attrs:{label:"现价"}},[o("el-input",{attrs:{readonly:""},model:{value:e.newprice,callback:function(n){e.newprice=n},expression:"newprice"}})],1),e._v(" "),o("el-form-item",{staticStyle:{position:"relative"},attrs:{label:"原描述图片"}},e._l(e.bookForm.imgurl,function(e){return o("div",{key:e.index,staticStyle:{float:"left","margin-left":"20px"}},[o("el-image",{staticStyle:{width:"90px",height:"90px"},attrs:{src:"http://localhost:8088/upload/"+e}})],1)}),0),e._v(" "),o("el-form-item",{attrs:{label:"书本描述"}},[o("el-input",{staticStyle:{width:"280px"},attrs:{type:"textarea",rows:4,placeholder:"几成新呢，描述下你的书吧"},model:{value:e.bookForm.tips,callback:function(n){e.$set(e.bookForm,"tips",n)},expression:"bookForm.tips"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"修改描述图片"}},[o("el-upload",{class:{hideUpload:e.hideUploadAdd},attrs:{action:"",multiple:"","list-type":"picture-card","file-list":e.filelist,"auto-upload":!1,"on-change":e.handleAddChange,"on-exceed":e.handleExceed,"on-remove":e.handleRemove,limit:e.limitCount},scopedSlots:e._u([{key:"file",fn:function(n){var t=n.file;return o("div",{},[o("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:t.url,alt:""}}),e._v(" "),o("span",{staticClass:"el-upload-list__item-actions"},[o("span",{staticClass:"el-upload-list__item-preview",on:{click:function(n){return e.handlePictureCardPreview(t)}}},[o("i",{staticClass:"el-icon-zoom-in"})]),e._v(" "),e.disabled?e._e():o("span",{staticClass:"el-upload-list__item-delete",on:{click:function(n){return e.handleRemove(t)}}},[o("i",{staticClass:"el-icon-delete"})])])])}}])},[o("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"}),e._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("（最多上传5张图片）")])]),e._v(" "),o("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(n){e.dialogVisible=n}}},[o("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),e._v(" "),o("el-form-item",{staticClass:"form-btn"},[o("el-button",{attrs:{type:"primary"},on:{click:function(n){return e.resetForm("bookForm")}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(n){return e.submitForm("bookForm")}}},[e._v("修 改")])],1)],1)],1),e._v(" "),o("pagefooter")],1)],1)};m._withStripped=!0;var d={render:m,staticRenderFns:[]},p=d;var c=!1;var u=t("VU/8")(r,p,!1,function(e){c||t("Je7I")},"data-v-5f632604",null);u.options.__file="src/components/user/book/updateBook.vue";n.default=u.exports},Je7I:function(e,n,t){var o=t("b6Z9");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);t("rjj0")("63d18c08",o,!1,{})},b6Z9:function(e,n,t){(e.exports=t("FZ+f")(!0)).push([e.i,"\n.hideUpload[data-v-5f632604] .el-upload{\n  display: none;\n}\n.form-btn[data-v-5f632604]{\n margin-left:200px\n}\n.form-btn[data-v-5f632604] .el-button--primary{\n  background-color: #E0B41B;\n  border: 1px solid #E0B41B;\n  margin-left: 80px;\n  width: 120px;\n}\n[data-v-5f632604] .el-form-item .el-input{\n  width: 280px;\n  margin: 0 auto;\n}\n.book-form[data-v-5f632604]{\n  width: 1000px;\n  margin: 0 auto;\n  margin-top: 30px;\n}\n.search[data-v-5f632604]{\n  width: 1224px;\n  margin: 0 auto;\n}\n.history[data-v-5f632604]{\n  position: relative;\n  margin-left: 210px;\n  padding-top: 0px;\n}\n.his-li[data-v-5f632604]{\n  float: left;\n  color: #333333;\n  font-size: 12pt;\n  margin-left: 8px;\n  opacity: 0.8;\n}\n.banner[data-v-5f632604]{\n  width: 100%;\n  background-color: #E9EBE7;\n  border: 1px solid #E9EBE7;\n}\n.search-input[data-v-5f632604]{\n  margin-left:450px;\n  margin-top: 2px;\n}\n","",{version:3,sources:["C:/StudyProject/GitPro/vue-springboot-bookstores/ui-bookstore/src/components/user/book/src/components/user/book/updateBook.vue"],names:[],mappings:";AA0TA;EACA,cAAA;CACA;AAEA;CACA,iBAAA;CACA;AACA;EACA,0BAAA;EACA,0BAAA;EACA,kBAAA;EACA,aAAA;CACA;AACA;EACA,aAAA;EACA,eAAA;CACA;AACA;EACA,cAAA;EACA,eAAA;EACA,iBAAA;CAEA;AAEA;EACA,cAAA;EACA,eAAA;CACA;AACA;EACA,mBAAA;EACA,mBAAA;EACA,iBAAA;CACA;AACA;EACA,YAAA;EACA,eAAA;EACA,gBAAA;EACA,iBAAA;EACA,aAAA;CACA;AACA;EACA,YAAA;EACA,0BAAA;EACA,0BAAA;CACA;AACA;EACA,kBAAA;EACA,gBAAA;CACA",file:"updateBook.vue",sourcesContent:['<template>\n  <div>\n    <el-container direction="vertical">\n      <el-main><pageheader></pageheader></el-main>\n      <div class="banner">\n        <el-container direction="horizontal" class="search">\n          <el-main>\n            <el-image :src="require(\'@/assets/img/logo.png\')" style="width: 230px;height: 88px"></el-image>\n          </el-main>\n          <el-container direction="vertical">\n            <el-main class="search-input">\n              <el-input placeholder="请输入内容" style="width:320px"></el-input> <el-button><span>搜索</span></el-button></el-main>\n            <el-main class="history">\n              <ul class="history">\n                <li class="his-li">莫言</li>\n                <li class="his-li">余光中</li>\n                <li class="his-li">毛姆</li>\n                <li class="his-li">追风筝的人</li>\n                <li class="his-li">莫言</li>\n                <li class="his-li">余光中</li>\n              </ul>\n\n            </el-main>\n          </el-container>\n        </el-container>\n      </div>\n      <div>\n    <el-form  :inline="true" :label-position="postion" :model="bookForm" status-icon  ref="bookForm" label-width="100px" class="book-form">\n          <el-form-item  label="ISBN" class="">\n            <el-input v-model="bookForm.iSBN"></el-input>\n          </el-form-item>\n          <el-form-item label="书名">\n            <el-input v-model="bookForm.bookName"></el-input>\n          </el-form-item>\n          <el-form-item label="作者">\n            <el-input v-model="bookForm.author"></el-input>\n          </el-form-item>\n          <el-form-item label="出版社">\n            <el-input v-model="bookForm.publisher"></el-input>\n          </el-form-item>\n          <el-form-item label="出版日期">\n            <el-date-picker\n              v-model="bookForm.publishTime"\n              type="month"\n              format="yyyy-MM"\n              value-format="yyyy-MM-dd"\n              placeholder="选择年月">\n            </el-date-picker>\n          </el-form-item>\n          <el-form-item label="数量">\n\x3c!--            <el-input v-model.number="bookForm.storage"></el-input>--\x3e\n            <el-input-number v-model="bookForm.storage" size="large" controls-position="right"  :min="1" :max="999" style="width: auto">\n            </el-input-number>\n          </el-form-item>\n          <el-form-item label="单价">\n            <el-input v-model="bookForm.price"></el-input>\n          </el-form-item>\n          <el-form-item label="折扣">\n            <el-input v-model="bookForm.discount" placeholder="请输入百分比折扣" @change="formatDiscount">\n              <template slot="append">%</template>\n            </el-input>\n          </el-form-item>\n          <el-form-item label="现价">\n            <el-input v-model="newprice" readonly></el-input>\n          </el-form-item>\n      <el-form-item label="原描述图片" style="position: relative">\n        <div v-for="img in bookForm.imgurl" :key="img.index" style="float: left;margin-left: 20px">\n\x3c!--          <img--\x3e\n\x3c!--            class="el-upload-list__item-thumbnail"--\x3e\n\x3c!--            :src="\'http://localhost:8088/upload/\'+img" alt=""--\x3e\n\x3c!--            >--\x3e\n            <el-image\n              :src="\'http://localhost:8088/upload/\'+img" style="width: 90px;height: 90px"\n            ></el-image>\n        </div>\n      </el-form-item>\n\n      <el-form-item label="书本描述">\n        <el-input\n          type="textarea"\n          :rows="4"\n          placeholder="几成新呢，描述下你的书吧"\n          v-model="bookForm.tips"\n          style="width: 280px;"></el-input>\n      </el-form-item>\n\n      <el-form-item label="修改描述图片">\n        <el-upload\n          action=""\n          multiple\n          list-type="picture-card"\n          :file-list="filelist"\n          :auto-upload="false"\n          :class="{hideUpload:hideUploadAdd}"\n          :on-change="handleAddChange"\n          :on-exceed="handleExceed"\n          :on-remove="handleRemove"\n          :limit="limitCount"\n        >\n          <i slot="default" class="el-icon-plus"></i>\n          <div class="el-upload__tip" slot="tip">（最多上传5张图片）</div>\n          <div slot="file" slot-scope="{file}">\n            <img\n              class="el-upload-list__item-thumbnail"\n              :src="file.url" alt=""\n            >\n            <span class="el-upload-list__item-actions">\n        <span\n          class="el-upload-list__item-preview"\n          @click="handlePictureCardPreview(file)"\n        >\n          <i class="el-icon-zoom-in"></i>\n        </span>\n        <span\n          v-if="!disabled"\n          class="el-upload-list__item-delete"\n          @click="handleRemove(file)"\n        >\n          <i class="el-icon-delete"></i>\n        </span>\n      </span>\n          </div>\n        </el-upload>\n        \x3c!--    放大图--\x3e\n        <el-dialog :visible.sync="dialogVisible">\n          <img width="100%" :src="dialogImageUrl" alt="">\n        </el-dialog>\n      </el-form-item>\n      <el-form-item class="form-btn">\n        <el-button type="primary" @click="resetForm(\'bookForm\')">取 消</el-button>\n        <el-button type="primary" @click="submitForm(\'bookForm\')">修 改</el-button>\n      </el-form-item>\n    </el-form>\n      </div>\n    <pagefooter></pagefooter>\n    </el-container>\n  </div>\n\n</template>\n\n<script>\n  import {findbookbyid,updatebook} from "../../../axios/api";\n  import pageheader from "../../pageheader";\n  import pagefooter from "../../pagefooter";\n\n    export default {\n        name: "updatebook",\n        data(){\n          return{\n            bookForm:{\n              code:\'\',\n              userId:\'\',\n              iSBN:\'\',\n              bookName:\'\',\n              author:\'\',\n              imgurl:\'\',\n              publisher:\'\',\n              publishTime:\'\',\n              price:\'\',\n              discount:\'\',\n              upDate:\'\',\n              storage:\'\',\n              tips:\'\',\n              imgList:[],\n            },\n            dialogImageUrl: \'\',\n            dialogVisible: false,\n            disabled: false,\n            hideUploadAdd:false,\n            filelist:[],\n            limitCount:4,\n            postion:\'left\'\n          }\n      },\n      components: {\n        pageheader,\n        pagefooter\n      },\n      computed:{\n        newprice:function () {\n          let val=this.bookForm.price*this.bookForm.discount*0.01\n          let price=Number(val).toFixed(3)\n          let realVal = price.substring(0, price.length - 1)\n          return  Number(realVal);\n        }\n      },\n        mounted() {\n           let bookId=this.$route.params.bookId;\n           findbookbyid(bookId).then(res=>{\n             if(res.data!=null){\n               console.log(res.data);\n               this.bookForm=res.data;\n               console.log(res.data.imgurl)\n               let imglist=res.data.imgurl.split(",")\n                this.bookForm.imgurl=imglist\n               //datepicker 只接受date()格式\n               this.bookForm.publishTime=new Date(this.bookForm.publishTime);\n             }\n           })\n\n        },\n      methods:{\n        formatDiscount(val){\n          const r = /^\\+?[1-9][0-9]*$/;//正整数\n          if(!r.test(val)){\n            this.$message({\n              type:"warning",\n              message:"折扣输入格式有误",\n              showClose:true\n            })\n          }\n        },\n        newTransformBase64(list, callback, errorCallback) {\n          let promise = [];\n          list.forEach((item, index) => {\n            let p = new Promise((resolve, reject) => {\n              let reader = new FileReader();\n              let obj;\n              if (item.raw) {\n                reader.readAsDataURL(item.raw);\n                reader.onload = function (e) {\n                  obj = reader.result;\n                  resolve(obj);\n                }\n              }\n            })\n            promise.push(p);\n          })\n\n          Promise.all(promise).then(results => {\n            callback(results);\n          }).catch(error => {\n            errorCallback && errorCallback();\n            this.$message.error("错误");\n          });\n        },\n        // 上传change事件\n        handleAddChange(file){\n\n          // 图片大小限制\n          const isLt20M = file.size / 1024 / 1024 < 20;\n          if (!isLt20M) {\n            this.$message.error("上传图片大小不能超过 20MB!");\n            this.filelist.splice(-1, 1);\n          } else {\n            this.filelist.push(file);\n          }\n          this.hideUploadAdd=this.filelist.length>=this.limitCount;\n        },\n\n        // 多选大于限制个数时做提示\n        handleExceed(file) {\n          // 上传文件>=限制个数时隐藏上传组件\n          this.hideUploadAdd=true;\n          this.$message({\n            message: "上传文件超出限制个数！",\n            type: "warning"\n          })\n\n\n        },\n        handleRemove(file) {\n          //从filelist当前图片uid\n          var list=this.filelist;\n          list.forEach((item,index)=>{\n            if(item.uid==file.uid){\n              console.log("uid配对")\n              this.filelist.splice(index,1)\n            }\n          })\n          this.hideUploadAdd=this.filelist.length>=this.limitCount;\n        },\n        handlePictureCardPreview(file) {\n          this.dialogImageUrl = file.url;\n          this.dialogVisible = true;\n        },\n      submitForm(formname){\n          console.log(this.filelist)\n        this.newTransformBase64(this.filelist, (results) => {\n          this.bookForm.imgList=results;\n          var bookparam=this.bookForm;\n          this.bookForm.imgurl=null;\n          this.bookForm.publishTime=new Date(this.bookForm.publishTime);\n          this.bookForm.userId=this.$store.state.user.userId;//添加该书本的用户\n          console.log(this.$store.state.user.userId);\n          this.bookForm.code=\'10001\';//图书类型id\n          var bookparam=this.bookForm;\n          updatebook(bookparam).then(res=>{\n            if(res.data!=0){\n              console.log(res.data)\n              this.$message({\n                showClose:true,\n                message:"修改成功",\n                type:\'success\'\n              })\n              //跳转到详情页\n              this.$router.push({\n                name:\'bookdetail\',\n                params:{\n                  bookId:res.data\n                }\n              })\n            }\n          })\n        })\n      },\n        resetForm(formName) {\n          this.$refs[formName].resetFields();\n        }\n      }\n    }\n<\/script>\n\n<style scoped>\n  .hideUpload /deep/ .el-upload{\n    display: none;\n  }\n\n  .form-btn{\n   margin-left:200px\n  }\n  .form-btn>>>.el-button--primary{\n    background-color: #E0B41B;\n    border: 1px solid #E0B41B;\n    margin-left: 80px;\n    width: 120px;\n  }\n  /deep/ .el-form-item .el-input{\n    width: 280px;\n    margin: 0 auto;\n  }\n  .book-form{\n    width: 1000px;\n    margin: 0 auto;\n    margin-top: 30px;\n\n  }\n\n  .search{\n    width: 1224px;\n    margin: 0 auto;\n  }\n  .history{\n    position: relative;\n    margin-left: 210px;\n    padding-top: 0px;\n  }\n  .his-li{\n    float: left;\n    color: #333333;\n    font-size: 12pt;\n    margin-left: 8px;\n    opacity: 0.8;\n  }\n  .banner{\n    width: 100%;\n    background-color: #E9EBE7;\n    border: 1px solid #E9EBE7;\n  }\n  .search-input{\n    margin-left:450px;\n    margin-top: 2px;\n  }\n</style>\n'],sourceRoot:""}])}});
//# sourceMappingURL=11.966dccfdab386710c70d.js.map